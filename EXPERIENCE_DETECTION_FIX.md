# Исправление проблемы с определением опыта работы

## Проблема
Система не могла корректно определять опыт работы из резюме HH, где опыт записан под заголовками "Специализации", "Проекты", "Фриланс" и т.д. вместо стандартного "Опыт работы".

## Решение

### 1. Расширенный детектор опыта работы (`backend/utils/experience.js`)

**Новые возможности:**
- Поиск опыта по альтернативным заголовкам: "Проекты", "Кейсы", "Портфолио", "Практика", "Стажировка", "Фриланс", "Консалтинг"
- Распознавание формата HH с датами в начале строки: "2022 - н.в. | Должность | Компания"
- Исключение "шумных" заголовков: "Специализации", "Навыки", "Образование"
- Маркировка найденных блоков опыта тегами `[EXPERIENCE]...[/EXPERIENCE]`

**Статистика тестирования:** 83% успешного распознавания (5 из 6 тестовых случаев)

### 2. Безопасный парсер оценок (`backend/utils/score.js`)

**Решает проблему "0/100":**
- Парсит различные форматы оценок: "70/100", "85%", "Оценка: 75", "80 из 100"
- Возвращает `null` вместо `0`, если оценка не найдена
- Ограничивает значения диапазоном 0-100

### 3. Маппер DTO (`backend/utils/reviewMapper.js`)

**Устойчивая обработка ответов модели:**
- Безопасно извлекает оценки из разных форматов ответа
- Вычисляет среднюю оценку, если `overall` не указан
- Нормализует массивы (strengths, gaps, questions)
- Обрабатывает неполные ответы модели

### 4. Обновленные промпты (`backend/server.js`)

**Жёсткая схема JSON:**
- Закреплены ключи на английском языке
- Указана точная структура ответа
- Добавлены инструкции по распознаванию HH-структуры

### 5. Безопасный экстрактор JSON (`backend/utils/safeJson.js`)

**Резервный механизм:**
- Извлекает JSON из текста, если модель вернула текст с JSON внутри
- Обрабатывает случаи, когда модель "забыла" вернуть чистый JSON

## Результат

✅ **Детектор опыта:** находит опыт в 83% случаев (включая HH-форматы)
✅ **Парсер оценок:** корректно обрабатывает все форматы оценок
✅ **Маппер DTO:** возвращает `null` вместо `0` для отсутствующих оценок
✅ **Система:** устойчива к различным форматам ответов модели

## Использование

Система автоматически применяет все улучшения при обработке резюме через эндпоинт `/api/resume/review`. Никаких изменений в API не требуется.

## Тестирование

Для проверки работы системы можно использовать:
```bash
# Запуск сервера
npm start

# Тестирование через веб-интерфейс
# Загрузите резюме в формате HH с заголовком "Специализации"
```
